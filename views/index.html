<!DOCTYPE html>
<html lang="es" data-theme="dark">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>URJConnect ‚Äî Foros</title>
        <meta name="description" content="URJConnect ‚Ä¢ Foros de asignaturas con registro/login, favoritos y perfil. Single-file, super moderno." />
        <link href="css/styles.css" rel="stylesheet" />
        <link rel="icon" type="image/png" href="assets/logo.png" />
    </head>
    <body>
        <div class="aurora" aria-hidden="true"></div>
        <main>
            <!-- ============ AUTH  ============ -->
            <section id="auth" aria-label="Acceso">
                <div class="auth-shell">
                    <div class="auth-brand" aria-label="Marca">
                        <div class="logo" aria-hidden="true">
                            <img src="/assets/logo.png" alt="Logo URJConnect" style="width: 100%; height: 100%; object-fit: contain" />
                        </div>
                        <h1 class="wordmark">URJConnect</h1>
                    </div>
                    <section class="auth-card glass" aria-live="polite">
                        <div class="switch" role="tablist" aria-label="Cambiar entre iniciar sesi√≥n y crear cuenta">
                            <div class="pill" id="switchPill"></div>
                            <button class="active" id="btnLoginTab" role="tab" aria-selected="true" aria-controls="loginPanel">Iniciar sesi√≥n</button>
                            <button id="btnRegisterTab" role="tab" aria-selected="false" aria-controls="registerPanel">Crear cuenta</button>
                        </div>
                        <div class="forms" id="formsWrap">
                            <!-- LOGIN -->
                            <form id="loginForm" class="active" aria-labelledby="btnLoginTab">
                                <div class="field">
                                    <label for="li_email">Email</label>
                                    <input id="li_email" name="email" type="email" autocomplete="username" placeholder="tucorreo@ejemplo.com" required />
                                </div>
                                <div class="field">
                                    <label for="li_pass">Contrase√±a</label>
                                    <input id="li_pass" name="password" type="password" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
                                </div>
                                <div class="actions">
                                    <button class="btn" type="submit">Entrar</button>
                                </div>
                                <div class="error" id="loginError" role="alert" aria-live="assertive"></div>
                            </form>
                            <!-- REGISTER -->
                            <form id="registerForm" aria-labelledby="btnRegisterTab">
                                <div class="row">
                                    <div class="field">
                                        <label for="r_name">Nombre</label>
                                        <input id="r_name" name="name" type="text" placeholder="Tu nombre" required />
                                    </div>
                                    <div class="field">
                                        <label for="r_email">Email</label>
                                        <input id="r_email" name="email" type="email" placeholder="tucorreo@ejemplo.com" required />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="field">
                                        <label for="r_pass">Contrase√±a</label>
                                        <input id="r_pass" name="password" type="password" placeholder="M√≠n. 6 caracteres" minlength="6" required />
                                    </div>
                                    <div class="field">
                                        <label for="r_pass2">Repetir contrase√±a</label>
                                        <input id="r_pass2" name="password2" type="password" placeholder="Repite la contrase√±a" minlength="6" required />
                                    </div>
                                </div>
                                <div class="field">
                                    <label for="r_bio">Bio (opcional)</label>
                                    <textarea id="r_bio" name="bio" rows="2" placeholder="Cu√©ntanos algo breve sobre ti..."></textarea>
                                </div>
                                <div class="actions">
                                    <button class="btn" type="submit">Crear cuenta</button>
                                </div>
                                <div class="error" id="registerError" role="alert" aria-live="assertive"></div>
                            </form>
                        </div>
                    </section>
                </div>
            </section>

            <!-- ============ APP ============ -->
            <section id="app">
                <header class="app-header glass">
                    <div class="brand">
                        <div class="logo" aria-hidden="true">
                            <img src="/assets/logo.png" alt="Logo URJConnect" style="width: 100%; height: 100%; object-fit: contain" />
                        </div>
                        <div class="brand-wordmark" aria-label="URJConnect">URJConnect</div>
                    </div>
                    <div class="search">
                        <div class="field" style="display: flex; align-items: center; gap: 8px">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                <path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            </svg>
                            <input id="searchInput" type="search" placeholder="Buscar asignaturas..." />
                        </div>
                    </div>
                    <div class="toolbar">
                        <button class="icon-btn" id="themeToggle" title="Cambiar tema">üåì Tema</button>
                        <div class="divider"></div>
                        <button class="icon-btn admin-only" id="btnOpenCreateSubject" style="display: none" title="Crear nueva asignatura">‚ûï Crear foro</button>
                        <div class="profile">
                            <button class="profile-btn" id="profileButton" aria-expanded="false" aria-controls="profileMenu">
                                <div class="avatar" id="avatar">
                                    <span id="avatarInitials"></span>
                                </div>
                                <span id="profileName">Tu Nombre</span>
                            </button>
                            <div class="profile-menu dropdown" id="profileMenu">
                                <button class="icon-btn" id="btnEditProfile">‚úèÔ∏è Editar perfil</button>
                                <button class="icon-btn" id="btnLogout">üö™ Cerrar sesi√≥n</button>
                            </div>
                        </div>
                    </div>
                </header>
                <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; max-width: 1200px" class="chips">
                    <div style="display: flex; gap: 8px; align-items: center">
                        <button class="icon-btn" id="filterFavsBtn" aria-pressed="false">
                            <span class="star" aria-hidden="true">‚òÜ</span>
                            <span class="label">Favoritos</span>
                        </button>
                    </div>
                    <div style="flex: 1"></div>
                </div>
                <div class="chips" id="chipsRow" aria-label="Favoritos anclados"></div>
                <section class="grid container" id="cardsGrid" aria-live="polite"></section>
            </section>
        </main>
        <div class="modal" id="profileModal" role="dialog" aria-modal="true" aria-labelledby="profileTitle">
            <div class="content glass">
                <div class="body">
                    <h3 id="profileTitle" style="margin: 0 0 8px 0">Editar perfil</h3>
                    <small class="hint">Actualiza tu nombre, color de avatar y una breve bio.</small>
                    <div class="field" style="margin-top: 12px">
                        <label for="p_name">Nombre</label>
                        <input id="p_name" type="text" placeholder="Tu nombre" style="width: 100%; max-width: 420px" />
                    </div>
                    <div class="field" style="margin-top: 10px">
                        <label for="p_color">Color del avatar</label>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px">
                            <div class="swatches" id="p_swatches" aria-hidden="true"></div>
                            <input id="p_color" type="color" value="#6366f1" aria-label="Color personalizado" />
                        </div>
                        <small class="hint">Elige un color para tu avatar o usa uno de los swatches.</small>
                    </div>
                    <div class="field">
                        <label for="p_bio">Bio</label>
                        <textarea id="p_bio" rows="3" placeholder="Cu√©ntanos algo breve sobre ti..."></textarea>
                    </div>
                    <div class="actions" style="justify-content: flex-end">
                        <button class="btn" id="saveProfile">Guardar cambios</button>
                        <button class="btn secondary" data-close="#profileModal">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal" id="forumModal" role="dialog" aria-modal="true" aria-labelledby="forumTitle">
            <div class="content glass">
                <div class="head">
                    <h3 id="forumTitle">Foro</h3>
                    <button class="close" data-close="#forumModal">Cerrar</button>
                </div>
                <div class="body">
                    <div class="posts" id="posts"></div>
                    <div class="row">
                        <div class="field">
                            <label for="newPost">Nuevo mensaje</label>
                            <textarea id="newPost" rows="3" placeholder="Comparte una duda, recurso o idea..."></textarea>
                        </div>
                        <div style="display: flex; align-items: flex-end">
                            <button class="btn" id="sendPost">Publicar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="toast" id="toast" role="status" aria-live="polite"></div>

        <!-- Modal Crear Asignatura (Admin) -->
        <div class="modal" id="createSubjectModal" role="dialog" aria-modal="true" aria-labelledby="createSubjectTitle" style="display: none">
            <div class="content glass">
                <div class="head" style="display: flex; justify-content: space-between; align-items: center; gap: 12px">
                    <h3 id="createSubjectTitle" style="margin: 0">Crear nueva asignatura</h3>
                </div>
                <div class="body" style="display: flex; flex-direction: column; gap: 12px">
                    <div class="field">
                        <label for="cs_name">Nombre</label>
                        <input id="cs_name" type="text" placeholder="Nombre visible" required />
                    </div>
                    <div class="field">
                        <label for="cs_desc">Descripci√≥n corta</label>
                        <textarea id="cs_desc" rows="2" placeholder="Resumen corto"></textarea>
                    </div>
                    <div class="field">
                        <label for="cs_long">Descripci√≥n larga</label>
                        <textarea id="cs_long" rows="3" placeholder="Descripci√≥n detallada"></textarea>
                    </div>
                    <div class="row" style="display: flex; gap: 12px">
                        <div class="field" style="flex: 1">
                            <label for="cs_credits">Cr√©ditos</label>
                            <input id="cs_credits" type="number" min="0" value="6" />
                        </div>
                        <div class="field" style="flex: 1">
                            <label for="cs_prof">Profesor</label>
                            <input id="cs_prof" type="text" />
                        </div>
                    </div>
                    <div class="field">
                        <label for="cs_sched">Horario</label>
                        <input id="cs_sched" type="text" placeholder="Lunes 10:00-12:00" />
                    </div>
                    <div class="field">
                        <label>Color</label>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px">
                            <div class="swatches" id="cs_swatches" aria-hidden="true"></div>
                            <input id="cs_color" type="color" value="#6366f1" aria-label="Color personalizado" />
                        </div>
                        <small class="hint">Elige uno de los colores o usa el selector.</small>
                    </div>
                    <div class="field">
                        <label for="cs_iconFile">Icono (subir imagen)</label>
                        <input id="cs_iconFile" type="file" accept="image/*" />
                        <small class="hint">Se guardar√° en /assets y se asignar√° autom√°ticamente.</small>
                    </div>
                    <div class="actions" style="justify-content: flex-end; gap: 8px">
                        <button class="btn secondary" data-close="#createSubjectModal">Cancelar</button>
                        <button class="btn" id="btnCreateSubject">Crear</button>
                    </div>
                    <div class="error" id="createSubjectError" role="alert" aria-live="assertive"></div>
                </div>
            </div>
        </div>
        <template id="cardTemplate">
            <article class="card" tabindex="0">
                <div class="spark" aria-hidden="true"></div>
                <div class="card-head">
                    <div class="subject">
                        <div class="ico" data-bg></div>
                        <div class="title" data-title style="font-size: 16px"></div>
                    </div>
                    <button class="fav-toggle" title="Marcar como favorito" data-fav>‚òÜ</button>
                </div>
                <p data-desc></p>
                <div class="cta">
                    <button type="button" class="link" data-details>Detalles</button>
                    <button class="enter" data-enter>Entrar al foro</button>
                </div>
            </article>
        </template>
        {{#jsonUser}}
        <script id="__initialUser" type="application/json">
            {{{jsonUser}}}
        </script>
        {{/jsonUser}}
        <script src="/app.js"></script>
    </body>
</html>
